name: Docs CI

on:
  push:
    branches: ["**"]
  pull_request:
    branches: ["**"]

jobs:
  docs:
    name: Lint and validate documentation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install linters
        run: |
          npm install -g markdownlint-cli@0.34.0 markdown-link-check@3.10.3 cspell@6 alex@8

      # ------------------------------
      # Markdownlint (non-fatal)
      # ------------------------------
      - name: Run markdownlint (non-fatal)
        run: |
          echo "Running markdownlint..."
          markdownlint "**/*.md" || echo "markdownlint finished with warnings, continuing..."

      # ------------------------------
      # Link Checker (non-fatal)
      # ------------------------------
      - name: Check Markdown links (non-fatal)
        run: |
          echo "Checking links in Markdown files..."
          files=$(git ls-files 'docs/*.md' 'README.md')
          for f in $files; do
            echo "Checking $f"
            markdown-link-check "$f" || echo "markdown-link-check failed on $f, continuing..."
          done

      # ------------------------------
      # Spell Check (non-fatal)
      # ------------------------------
      - name: Spell check Markdown with cspell (non-fatal)
        run: |
          echo "Running cspell..."
          cspell "docs/*.md" "README.md" || echo "cspell finished with warnings, continuing..."

      # ------------------------------
      # Prose checker (non-fatal)
      # ------------------------------
      - name: Prose check with alex (non-fatal)
        run: |
          echo "Running alex..."
          files=$(git ls-files 'docs/*.md' 'README.md')
          for f in $files; do
            alex "$f" || true
          done